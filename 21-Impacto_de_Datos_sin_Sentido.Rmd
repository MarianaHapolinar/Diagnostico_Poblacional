# Impactos de datos sin sentido sobre los análisis de dinámica poblacional

Por: Raymond L. Tremblay

El valor principal de los estudios científicos proviene es que los datos representa una visión suficiente cerca a la realidad. En ningún estudio ecológico se podrá obtener **TODOS** los datos para evaluar la relación biótica y abiótica sobre un organismos y todas sus interacciones.   Ese modelo es primero demasionado complejo y irreal dentro del concepto de trabajo científico. El objetivo es tener una apreciación de los parámetros más importante para definir un cierto patrón o interacciones. Por consecuencia la base de todo estudios esta fundado en las unidades de los muestreos de colección de datos. Si los datos no representa la realidad del estudio la interpretaciones de los analisis pudiese ser erronea. La matematica y sus ecuaciones y modelos no harán que la biología sea más cerca a la realidad si desde el principio los datos y el metodo de recolección de datos es erróneo.  

En esta sección evaluamos diferentes aspectos de los analisis matriciales poblacional de projección y diferentes aspectos de la recolección de datos que pudiese ser problemáticos cuando uno considera la biología de una especie. Estos "Impactos" no pretenden incluir todos las posibles efecto de datos sin sentido, sino unos ejemplos si uno no considera estos problemas y cómo pueden distorsionar las interpretaciones. Por lo tanto, una advertencia a todos los biólogos de población para que estén consciente de estos temas.

***

## Tamaño de muestra pequeño o eventos raros

Sin duda, el tema principal para el uso de PPM ha sido evaluar la proyección de población de especies raras o en peligro de extinción (otras cuestiones son ecológicas o evolutivas) (ref). En consecuencia, las especies raras o en peligro de extinción son naturalmente pequeñas y reduce el tamaño de la muestra del estudio o de algunas de las etapas/edades de la vida. Estos tamaños de muestra reducidos provocan estimaciones de parámetros y, a menudo, resultados sin sentido biológicos.


***

### Sin Mortalidad/Supervivencia Perfecta

Considere una especie donde se recopilan datos de una especies **Sp1** y la matriz de transición **Sp1matU** es la siguiente y la matriz de fertilidad es **Sp1matF**. Tenga en cuenta que ninguno de los individuos murió en la etapa adulta (supervivencia perfecta). En consecuencia, el tamaño de la población nunca disminuye o aumenta después de un período de tiempo. Bajo TODOS los modelos biológicamente realistas, esperaríamos que el tamaño de la población comenzara a disminuir si una población no tiene reproducción.  Pero en este caso como todos los individuos de la etapa sobreviven la población es *eterna*.  


```{r}
library(DiagrammeR)

Sp1matU <- rbind(
  c(0.0, 0.0, 0.0),
  c(0.5, 0.3, 0.0),
  c(0.0, 0.4, 1.0)
) # transition matrix

Sp1matF <- rbind(
  c(0.0, 0.0, 1.0),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA = Sp1matU+Sp1matF # TF matrix
library(Rage)
stages <- c("plantula", "juvenil", "adulto")

plot_life_cycle(Sp1matU, stages=stages, fontsize = 0)
```

Así si analizamos esta matriz asumimos que ninguno de los individuos en etapa adulta muere, en ningún momento!!!. Claramente esto no es realista. Para cualquier especie, la probabilidad de muerte en cualquier etapa nunca es cero (aunque podría ser muy pequeña) y, por lo tanto, nuestra matriz no tiene sentido. Considere una especie de árbol, como *Sequoia*, es probable que para los árboles grandes de esta especie la supervivencia sea muy alta entre un año y otro, pero nunca del 100%.  Es que en el sitio de muestreo NO se observo mortalidad de los arboles grandes. 

En el siguiente script mostramos que la población no cambia después de 5-6 periodos y se mantiene cercana a uno y no cambia nada aunque no tengamos reclutas (usamos la matriz de transición sin fecundidad). Si no hay reclutas (matriz de fertilidad), el tamaño de la población debería reducirse con el tiempo. Todo modelos de transiciones que no incluye la matriz de fertilidad debería resultar en reducción de tamaño poblacional. 



```{r}
n=c(5,5,5)

library(popdemo)
library(popbio)
truelambda(Sp1matU)
pop.projection(Sp1matU, n=n)$pop.changes
```


####  Suponga un pequeño cambio en la mortalidad.


Tenga en cuenta que en este nuevo modelo, aunque la tasa de supervivencia es muy cercana a cero (0,995) y, en consecuencia, es posible una disminución de la población en cada período de tiempo (aunque solo sea en una pequeña fracción). Siempre hay que considerar si esta taza de mortalidad es biologicamente real o es un resultado del tamaño de la muestra.  Este valor sugiere que se muestreo 1000 individuos y que 995 sobrevivieron.   Si el tamaño fue de 1000, uno pudiese tener confianza en el parametro.  

```{r}
Sp1matU_2 <- rbind(
  c(0.0, 0.0, 0.0),
  c(0.5, 0.3, 0.0),
  c(0.0, 0.4, 0.995)
) # transition matrix

Sp1matF <- rbind(
  c(0.0, 0.0, 1.0),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA_2=Sp1matU_2+Sp1matF

pop.projection(Sp1matU_2, n=n)$pop.changes

```

***

### Irreductibilidad: No hay transiciones entre etapas

En el escenario actual, los juveniles no crecen para convertirse en adultos, todos los juveniles siguen siendo juveniles o mueren. Tenga en cuenta la figura del ciclo de vida donde no hay flechas que conecten a los juveniles con los adultos.

```{r}
library(DiagrammeR)

Sp1matU_NT <- rbind(
  c(0.0, 0.0, 0.0),
  c(0.5, 0.7, 0.0),
  c(0.0, 0.0, 0.995)
) # transition matrix

Sp1matF <- rbind(
  c(0.0, 0.0, 1.0),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA_NT = Sp1matU_NT+Sp1matF # TF matrix
library(Rage)
stages <- c("plantula", "juvenil", "adulto")

plot_life_cycle(Sp1matU_NT, stages=stages, fontsize = 0)
```


Como lo muestra @caswell2000matrix y explorado más recientemente por @stott2010, las matrices deben de ser *irreducibles*. El concepto de *irreductibilidad* está asociado con el ciclo de vida de la especie y la matriz incluye las transiciones de todas las etapas a todas las demás etapas. A la figura del ciclo de vida anterior le faltan dos componentes importantes en la historia de vida de la especie, ningún juvenil crece para convertirse en adulto y ninguno de los adultos produce plántulas (semillas que crecen hasta convertirse en plántulas).

Una manera fácil de determinar si la matriz es irreducible es correr el siguiente script *isIrreducible* en el paquete (popdemo). Tenga en cuenta que, en este caso, el resultado es *Falso* para la matriz anterior.


```{r}
isIrreducible(Sp1matU_NT) # para la matriz de transición, faltando una etapa de transición y fertilidad
isIrreducible(Sp1matA_NT) # para la matriz TF, falta una etapa de transición

# Ahora considerando Sp1matA_2

isIrreducible(Sp1matA_2) # incluye todas las transiciones y la fertilidad
```


***

### No survivorship

Mortalidad completa de uno o más estadios. A menudo se observa que la supervivencia de los individuos más pequeños o la primera etapa del ciclo de vida de una especie es muy arriesgada, donde la probabilidad de supervivencia es muy baja. Por ejemplo, la mayoría de las semillas no sobreviven para germinar. Esta es probablemente la norma en las orquídeas donde la producción de semillas es muy alta (a veces millones de semillas en una cápsula de semillas, es decir, *Catasetum*; ref), pero pocas germinan (ref). Sin embargo, esto no se limita a las orquídeas, en los árboles se puede observar el mismo patrón, por ejemplo, en *Nothofagus pumilio* el reclutamiento de plántulas fue inferior al 1,5 % @torres2015seed.  NEED EXAMPLE OF NO SEED OR SEEDLING RECRUITMENTS.   

As it is well known that seed germination in orchids is less than straightforward and many variables may influence seed germination @rasmussen2015germination. .......

En el gráfico del ciclo de vida actual, ninguna de las plántulas sobrevive o crece a la siguiente etapa. Tenga en cuenta que en la primera columna de la matriz de transición todos los valores son cero. La población puede haber comenzado con muchas (incluso miles) de plántulas, pero ninguna creció hasta convertirse en un juvenil o permaneció como plántula antes del siguiente muestreo. Esto da como resultado una matriz que es reducible *esIrreducible* = *FALSO* y en consecuencia no cumple con los requisitos necesarios.


```{r}
library(DiagrammeR)

Sp1matU_NS <- rbind(
  c(0.0, 0.0, 0.0),
  c(0.0, 0.7, 0.0),
  c(0.0, 0.25, 0.995)
) # transition matrix

Sp1matF <- rbind(
  c(0.0, 0.0, 1.0),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA_NS = Sp1matU_NS+Sp1matF # TF matrix
library(Rage)
stages <- c("plantula", "juvenil", "adulto")

plot_life_cycle(Sp1matU_NS, stages=stages, fontsize = 0)

isIrreducible(Sp1matU_NS)
```


## Redondeo excesivo de valores

Uno de los errores más simples en la construcción de los elementos de la matriz es el error de redondeo excesivo u otras estimaciones que dan como resultado valores de supervivencia superiores a 1,00, lo que a veces da como resultado una supervivencia incluso superior al 100 %.

Por ejemplo en un análisis de *Serapia cordigera* @pellegrino2014effects. Aquí los autores evaluaron las transiciones entre latencia, plántulas, roseta vegetativa y floración. Aquí mostramos una de estas matrices en el material suplementario. Período de tiempo 2001-2002, A1.


```{r}
library(DiagrammeR)

SerapiaU <- rbind(
  c(0.668, 0.122, 0.294, 0.401),
  c(0.128, 0.0, 0.0, 0.0),
  c(0.0, 0.302, 0.453, 0.366),
  c(0.214, 0.364, 0.185, 0.207)
) # transition matrix

SerapiaF <- rbind(
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0, 0.0)
) # fertility matrix

SerapiaA = SerapiaU+SerapiaF # TF matrix
library(Rage)
stages <- c("latente", "plantulas", "vegetativa", "adulto")

plot_life_cycle(SerapiaA, stages=stages)

# Tenga en cuenta que la suma de supervivencia para la etapa inactiva es mayor que 1, igual a 1.01

```



***

## Estimaciones de fertilidad y ciclo de vida

La importancia de considerar cómo se incluye la fertilidad en el ciclo de vida es extremadamente influyente en los resultados de los modelos, y si se considera erróneamente puede dar lugar a interpretaciones sin sentido. Mostramos algunos ejemplos de cómo estos pueden incluirse en el ciclo de vida y la matriz y dar como resultado problemas de causa.


### Ciclo de vida y etapa de fertilidad incorrectos

Suponga que tiene una especie en la que modela el ciclo de vida como plántula, juvenil y adulto. La fertilidad se mide como el número de semillas producidas por un adulto (número medio de semillas por adulto). Después de recopilar los cálculos de datos, se determina que el número medio de semillas por adulto es 11000. Si agregamos la matriz de transición y fertilidad a continuación y evaluamos el lambda y graficamos el crecimiento de la población con la función *proyecto*, tenemos un lambda de 4.93 y después de solo 5 períodos de tiempo, el número de adultos supera los 250.000. En consecuencia, la estimación de la tasa de crecimiento de la población sería incorrecta y engañosa. 

El error es que el valor en la matriz de fertilidad debería corresponder a la primera etapa de la matriz, en este caso la etapa de plántula. Por lo tanto, la esquina superior derecha de la matriz de fertilidad no debe ser la **cantidad media de semillas** por planta, sino la **cantidad media de plántulas** producidas por una planta adulta.

```{r}
library(DiagrammeR)

Sp1matU_Fert <- rbind(
  c(0.0, 0.0, 0.0),
  c(0.3, 0.7, 0.0),
  c(0.0, 0.25, 0.995)
) # transition matrix

Sp1matF <- rbind(
  c(0.0, 0.0, 1100.0),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA_Fert = Sp1matU_Fert+Sp1matF # TF matrix
library(Rage)
stages <- c("plantula", "juvenil", "adulto")

lambda(Sp1matA_Fert)

# show change in population size
n
pr <- project(Sp1matA_Fert, vector="n", time=5)
plot(pr) # Note that even after just 5 time periods, the number of adults is larger than 250,000 individuals
```

Si deseamos agregar una etapa de semilla, debemos incluir la etapa en nuestro modelo y matriz con una nueva etapa *la etapa de semilla*, y tener una estimación del número de semillas que germinan y se convierten en plántulas. En el caso de las orquídeas, es probable que sea una estimación difícil de lograr porque las semillas de las orquídeas son difíciles de seguir en la naturaleza a menos que se haya desarrollado el método del paquete de semillas o se utilizó algún método de huella genética para determinar la procedencia de las semillas.

```{r}
library(DiagrammeR)

Sp1matU_Fert2 <- rbind(
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0001, 0.0, 0.0, 0.0),
  c(0.0, 0.3, 0.7, 0.0),
  c(0.0, 0.0, 0.25, 0.995)
) # transition matrix

Sp1matF2 <- rbind(
  c(0.0, 0.0, 0.0, 1100.0),
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA_Fert2 = Sp1matU_Fert2+Sp1matF2 # TF matrix
library(Rage)
stages <- c("semillas", "plantula", "juvenil", "adulto")

plot_life_cycle(Sp1matA_Fert2, stages=stages)

lambda(Sp1matA_Fert2)

# show change in population size
pr <- project(Sp1matA_Fert2, vector="n", time=5)
plot(pr) # Note that now the number of adults did not increase to the level of the previous model
```

En el ejemplo anterior no hemos incluido una etapa de latencia de semillas. En muchas especies de plantas, las semillas pueden permanecer latentes durante uno o más años. No se sabe si las semillas de las orquídeas están inactivas durante mucho tiempo @gale2010restricciones, excepto para algunas especies que han demostrado que las semillas aún están vivas después de varios años en el suelo usando la prueba de tinción de tetrazolio @rasmussen1993seed y @whigham2006seed.

***


## Problemas de análisis de datos

### Estimaciones de intervalos de confianza incorrectas

Las estimaciones de dispersión en los parámetros de la matriz de supervivencia, transición, muerte y fertilidad son útiles de múltiples maneras. El enfoque más básico es comprender la incertidumbre en el parámetro como una función del tamaño de la muestra, los parámetros con gran dispersión deben verse con precaución. Los parámetros de dispersión pueden ser útiles para simulaciones y comprender la incertidumbre en los parámetros de población como lambda y la probabilidad de persistencia y extinción.

Los parámetros de supervivencia, muerte, estasis y transiciones NO se distribuyen normalmente ya que los valores van de cero a 1. Ningún valor puede ser menor que cero o mayor que uno, incluidos los intervalos de confianza del 95 % (limitados por 0 y 1). Si se usa la distribución gaussiana (normal) es probable que el IC del 95 % esté fuera de los límites. Supongamos que deseamos calcular la probabilidad de supervivencia de una etapa y sus intervalos de confianza del 95%.

Encuestamos a 20 individuos de los cuales 19 sobrevivieron

 - Construya un intervalo de confianza del 95% de la proporción de individuos que murieron
 
Donde la proporción que murió es $\hat{p}$ y el número que murió es $n_d$ y $n$ es el tamaño de la muestra
 
 
$$\hat{p}=\frac{n_d}{n}$$ con una probabilidad de muerte del 20%. 
 
 

```{r}
p=1/20
p
```


El IC del 95% de una proporción se calcula

$$ \hat{p}\pm Z_{0.05}*\sqrt{}(\frac{\hat{p}(1-\hat{p})}{n})$$
- Z_{0.05} es el valor crítico de Z para un IC del 95% = 1.955

```{r}
n=20
HCI=p+(1.96*sqrt((p*(1-p))/n)) # IC alto
HCI

LCI=p-(1.96*sqrt((p*(1-p))/n)) # IC bajo
LCI # Nota que el valor es sin sentido, ya que es negativo
```

Un método más fácil es usar la función R *propCI* de la **biblioteca(interceptCI)**


```{r}
library(interpretCI)

resultado=propCI(n=20, p=0.05, alpha=0.05)

resultado
```

Sin embargo, ¿cómo se calcula el IC del 95% cuando hay más de 2 proporciones? Debido a que la proporción de todas las etapas depende de la proporción de las otras etapas, el análisis debe considerar la proporción y el IC del 95% debe incluir todas las etapas simultáneamente. La función requerida es la función de Dirichlet multinomial (multigrupo).


En el análisis estimamos los intervalos de confianza del 95% de la transición y estasis de plántulas a plántulas (50%), juveniles (20%), adultos (0%) y muerte (30%). Tenga en cuenta el gráfico del ciclo de vida que, como de costumbre, excluye la probabilidad de que mueran las plántulas.

```{r}

Dirichlet <- rbind(
  c(0.5, 0.0, 0.0),
  c(0.2, 0.0, 0.0),
  c(0.0, 0.3, 0.7)
) # transition matrix

library(Rage)
stages <- c("plantula", "juvenil", "adulto")

plot_life_cycle(Dirichlet, stages=stages)
```


## Enfoque de Dirichlet para estimar intervalos de confianza

Para evaluar el intervalo IC del 95% simultáneamente de las cuatro transiciones, usamos la **biblioteca (MCMCpack)**, que es un paquete dedicado a realizar simulaciones de Markov Chain Monte Carlo. Usaremos la función *MCmultinomdirichlet*. Tenga en cuenta que la primera lista son las proporciones que se muestran en la matriz para la etapa de plántula c(.50*b,.2*b,.0*b,.3*b) multiplicadas por el tamaño de la muestra b= 25. La segunda lista son los priores bayesianos c(.5,.2,0.0001,.3), en este caso asumí que la suma de los previos es igual a 1. Esto da como resultado una confianza muy baja en la percepción previa de lo que es la transición. son. La segunda suposición es que los previos para la transición observada son iguales, sin embargo, podríamos haber usado c(1,1,0,.000001, 1), donde este previo sugiere una transición igual para todos menos las plántulas que crecen hasta convertirse en adultos.   

El concepto de lo anterior no se puede explicar completamente aquí, consulte las siguientes referencias para obtener información más detallada.

Los resultados en la figura muestran que hay mucha dispersión alrededor de la proporción media de las estadísticas y la transición como se esperaba debido al pequeño tamaño de la muestra. Para convencerte, cambia el valor de **b** a un número grande y verás cómo cambia la distribución.


```{r, message=FALSE}

library(MCMCpack)
```


```{r}
b=25
L=posteriorPRIORL <- MCmultinomdirichlet(c(.50*b,.2*b,.0*b,.3*b), c(.5,.2,0.0001,.3), mc=10000)
dfL=as.data.frame(L)
t(summary(dfL))

#head(dfL)
stack_dfL=stack(dfL)
comb_dfbL= cbind(stack_dfL, T="25")

All_Data3=comb_dfbL
levels(All_Data3$ind)[levels(All_Data3$ind)=="pi.1"]="Plantulas"
levels(All_Data3$ind)[levels(All_Data3$ind)=="pi.2"]="Juvenil"
levels(All_Data3$ind)[levels(All_Data3$ind)=="pi.3"]="Adulto"
levels(All_Data3$ind)[levels(All_Data3$ind)=="pi.4"]="Muerto"

library(ggplot2)
ggplot(data=All_Data3, aes(x=values, fill=ind, colour=ind))+
  geom_density(aes(alpha=.5)) +
  scale_y_continuous(limit=c(0, 5.5))+
  scale_colour_hue(l=60)+
  facet_grid(~ind)



```


Ahora calculemos el IC del 95% de las transiciones

  - Intervalos de confianza de transiciones, estasis y supervivencia basados ​​en simulación y distribución de Dirichlet.
  
Aspectos importantes a tener en cuenta.

 - los IC del 95% están acotados entre 0 y 1. Los valores por debajo de cero o por encima de uno en los parámetros no tendrían sentido.
 - la suma de la media es igual a 1.
 - la suma de la mediana es igual a 1.
 - la forma de la distribución NO se distribuye normalmente, ver figura anterior. La forma de la distribución se llama distribución beta.



```{r}

library(plyr)
library(reshape2)

Transitions=ddply(All_Data3, c("ind"), summarise,
            mean = round(mean(values),3), sd = round(sd(values),4),
            median= median(values),
            #sem = round(sd(values)/sqrt(length(values)),6),
            CI5 = quantile(values, probs = c(0.05)),
            CI95 = round(quantile(values, probs = c(0.95)), 4),
            min=min(values),
            max=max(values)
            )

Transitions

```


Para comparar con el ejemplo anterior aumimos que en lado de tener solamente 25 plantas teniamos 250 plantas para ls estimados.

Nota que la mediana sigue en el mismo lugar (casi) pero los IC cambian mucho y es más reducido, ya que con más datos en el muestreo resulta en más confianza y reducción en el IC. 


  
```{r}
b=250
L=posteriorPRIORL <- MCmultinomdirichlet(c(.50*b,.2*b,.0*b,.3*b), c(.5,.2,0.0001,.3), mc=10000)
dfL=as.data.frame(L)
t(summary(dfL))

#head(dfL)
stack_dfL=stack(dfL)
comb_dfbL= cbind(stack_dfL, T="25")

All_Data4=comb_dfbL
levels(All_Data4$ind)[levels(All_Data3$ind)=="pi.1"]="Plantulas"
levels(All_Data4$ind)[levels(All_Data3$ind)=="pi.2"]="Juvenil"
levels(All_Data4$ind)[levels(All_Data3$ind)=="pi.3"]="Adulto"
levels(All_Data4$ind)[levels(All_Data3$ind)=="pi.4"]="Muerto"

library(ggplot2)
ggplot(data=All_Data4, aes(x=values, fill=ind, colour=ind))+
  geom_density(aes(alpha=.5)) +
  scale_y_continuous(limit=c(0, 18))+
  scale_colour_hue(l=60)+
  facet_grid(~ind)



```
  
```{r}

library(plyr)
library(reshape2)

Transitions=ddply(All_Data4, c("ind"), summarise,
            mean = round(mean(values),3), sd = round(sd(values),4),
            median= median(values),
            #sem = round(sd(values)/sqrt(length(values)),6),
            CI5 = quantile(values, probs = c(0.05)),
            CI95 = round(quantile(values, probs = c(0.95)), 4),
            min=min(values),
            max=max(values)
            )

Transitions

```


